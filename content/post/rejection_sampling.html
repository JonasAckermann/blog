---
title: "Bayesian Inference using rejection sampling"
author: "Jonny Law"
draft: TRUE
date: '2019-02-25'
slug: rejection-sampling
categories:
  - R
  - Bayesian
tags: []
---



<div id="coin-flip-model" class="section level1">
<h1>Coin Flip Model</h1>
<p>As an example, consider a (possibly biased) coin flip experiment. The parameter of interest is the probability of heads <span class="math inline">\(p_h\)</span>. A Beta distribution is chosen for the prior of <span class="math inline">\(p_h\)</span>, <span class="math inline">\(p(p_h) = \mathcal{B}(\alpha, \beta)\)</span>. The Beta distribution has support between 0 and 1, which is appropriate for a probability. The likelihood of a coin flip is Bernoulli, however the coin should be flipped several times in order to learn the parameter <span class="math inline">\(p_h\)</span>. The distribution for <span class="math inline">\(n\)</span> independent Bernoulli trials is the Binomial distribution, hence the likelihood can be written as <span class="math inline">\(\textrm{Bin}(Y;n,p_h)\)</span>. The coin is flipped <span class="math inline">\(n = 10\)</span> times and the results are displayed below:</p>
<span class="math display">\[\begin{equation*}
  \label{eq:4}
\{H, H, T, H, H, H, T, T, H, T\}  
\end{equation*}\]</span>
<p>Then <span class="math inline">\(Y = 6\)</span>, and it remains to determine the posterior distribution of the parameter <span class="math inline">\(p_h\)</span> representing the probability of obtaining heads. Applying Bayes theorem:</p>
<span class="math display">\[\begin{align*}
  p(p_h|Y) &amp;= \frac{p(p_h)\textrm{Bin}(Y;n,p_h)}{\int_0^1 p(Y|p_h) dp_h} \\
           &amp;\propto p_h^{\alpha - 1}(1-p_h)^{\beta-1}{n \choose Y}p_h^Y(1-p_h)^{n-Y} \\
           &amp;= p_h^{Y + \alpha - 1}(1 - p_h)^{n-Y + \beta - 1}
\end{align*}\]</span>
<p>The posterior distribution is a Beta distribution, <span class="math inline">\(\mathcal{B}(Y + \alpha, n - Y + \beta)\)</span>.</p>
<pre class="r"><code>Y &lt;- 6
n &lt;- 10

alpha &lt;- 3
beta &lt;- 3

prior &lt;- function(x) dbeta(x, alpha, beta)
posterior &lt;- function(x) dbeta(x, alpha + Y, n - Y + beta)

ggplot(data = data.frame(x = 0), mapping = aes(x = x)) +
  stat_function(fun = prior, aes(colour = &quot;Prior&quot;)) + xlim(0, 1) +
  stat_function(fun = posterior, aes(colour = &quot;Posterior&quot;)) +
  xlab(&quot;p_h&quot;) +
  ylab(&quot;Density&quot;) +
  theme(text = element_text(size = 20), legend.title = element_blank(), legend.position = c(0.2, 0.9), legend.text = element_text(size = rel(1.3)))</code></pre>
<p><img src="/post/rejection_sampling_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
</div>
<div id="rejection-sampler" class="section level1">
<h1>Rejection Sampler</h1>
<p>The rejection sampler is an algorithm which produces exact samples from the target distribution. Consider a problem where it is straightforward to evaluate the posterior density <span class="math inline">\(p(\cdot)\)</span> up to a constant. The rejection sampler algorithm proceeds as follows; start by sampling a value from a proposal distribution <span class="math inline">\(\psi^\star \sim q(\cdot)\)</span>, then accept the proposed value with probability <span class="math inline">\(p(\psi^\star)/Mq(\psi)\)</span>, where <span class="math inline">\(M\)</span> is an upper bound on <span class="math inline">\(p/q\)</span>. Algorithm~ shows a single step of the rejection sampler algorithm which returns a single sample from the target distribution <span class="math inline">\(p(\cdot)\)</span>.</p>
<ol style="list-style-type: decimal">
<li>Propose <span class="math inline">\(\psi^\star \sim q(\cdot)\)</span></li>
<li>Continuously sample <span class="math inline">\(u \sim U[0, 1]\)</span> and check the condition in step 3.</li>
<li>If <span class="math inline">\(u &lt; \frac{p(\psi^\star)}{Mq(\psi)}\)</span>, set <span class="math inline">\(\psi^\star\)</span> as a sample from <span class="math inline">\(p\)</span></li>
<li>Repeat 1-3 until enough samples are attained</li>
</ol>
<p>The figure below shows the empirical posterior distribution found for the coin flip experiment overlaid with the analytic posterior distribution. This algorithm performs well for low-dimensional problems, but finding the upper bound <span class="math inline">\(M\)</span> can be challenging. The rejection algorithm does not work well in higher dimensions as many proposed moves are rejected. Adding extra dimensions to the problem results in the exponential increase in volume, this is known as the curse of dimensionality. More sophisticated algorithms are required for high dimensional target distributions.</p>
<pre class="r"><code># Perform one rejection step
rejection_sample &lt;- function(prop, propPdf, log_density) {
  u &lt;- runif(1)
  y &lt;- prop(1)

  if (log(u) &lt; log_density(y) - propPdf(y)) {
    y
  } else {
    rejection_sample(prop, propPdf, log_density)
  }
}

log_density &lt;- function(alpha, beta, Y, n) {
  function(theta) {
    dbeta(theta, alpha, beta, log = T) + dbinom(Y, n, theta, log = T)
  }
}

samples &lt;- 1000
lden &lt;- log_density(alpha, beta, Y, n)
rejection_samples &lt;- replicate(samples, rejection_sample(runif, function(x) dunif(x, log = T), lden))

qplot(rejection_samples, geom = &quot;blank&quot;) +
  stat_function(fun = posterior, aes(colour = &quot;Analytic posterior&quot;)) +
  geom_histogram(aes(y = ..density..), alpha = 0.4) +
  theme(legend.position = &quot;none&quot;) +
  xlab(&quot;p_h&quot;) +
  theme(text = element_text(size = 20))</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-2"></span>
<img src="/post/rejection_sampling_files/figure-html/unnamed-chunk-2-1.png" alt="Empirical Posterior distribution for the coin flip problem using 1,000 samples from the rejection sampler with a Uniform(0, 1) proposal distribution and M = 1. The analytic posterior distribution is plotted as a solid red line." width="672" />
<p class="caption">
Figure 1: Empirical Posterior distribution for the coin flip problem using 1,000 samples from the rejection sampler with a Uniform(0, 1) proposal distribution and M = 1. The analytic posterior distribution is plotted as a solid red line.
</p>
</div>
</div>
